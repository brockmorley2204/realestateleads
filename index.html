<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Find Your Top Local Agent</title>
  <style>
    /* ===== THEME (tweak these 3 lines to match your brand) ===== */
    :root{
      --brand:#0b66ff;     /* primary */
      --brand-ink:#0a2550; /* headings/buttons text on light */
      --ok:#2e7d32;        /* submit */
    }
    /* ===== Base ===== */
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:
      radial-gradient(1200px 600px at 10% -10%,#e9f0ff,transparent),
      radial-gradient(1000px 500px at 120% 0%,#f5f7ff,transparent),
      #f6f7fb;color:#222;}
    .wrap{max-width:720px;margin:48px auto;padding:0 20px}
    .card{background:#fff;border:1px solid #eef2f7;padding:28px 28px 24px;border-radius:18px;
      box-shadow:0 30px 60px -30px rgba(15,30,60,.25)}
    h1{margin:0 0 6px;font-size:28px;color:var(--brand-ink);letter-spacing:.1px}
    .lead{margin:0 0 18px;color:#5d6b7b}
    /* Stepper */
    .stepper{display:flex;gap:10px;margin:8px 0 16px;padding:0;list-style:none}
    .stepper li{flex:1;display:flex;align-items:center;gap:10px}
    .dot{width:28px;height:28px;border-radius:50%;background:#edf2ff;border:1px solid #dfe7ff;
      color:#5a6aa0;display:grid;place-items:center;font-weight:700;font-size:13px}
    .label{font-size:12px;color:#7f8aa1}
    .stepper li.active .dot{background:var(--brand);border-color:var(--brand);color:#fff;box-shadow:0 6px 16px rgba(11,102,255,.35)}
    .stepper li.active .label{color:#2c3b5a;font-weight:600}
    /* Progress bar */
    .progress{height:8px;background:#eef2f7;border-radius:999px;overflow:hidden;margin:4px 0 22px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand) 0%,#6aa5ff 100%);transition:width .25s ease}
    /* Form */
    .step{display:none;animation:fadeUp .25s ease}
    .step.active{display:block}
    @keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    label{display:block;font-weight:700;margin:12px 0 8px;color:#2b3850}
    input,select{width:100%;padding:14px 14px;border:1px solid #e0e6ef;background:#fff;border-radius:12px;font-size:15px;
      transition:border .15s, box-shadow .15s}
    input:focus,select:focus{outline:none;border-color:#c9d7ff;box-shadow:0 0 0 4px #eaf0ff}
    .hint{font-size:12px;color:#77839a;margin-top:6px}
    .btns{display:flex;gap:12px;margin-top:18px}
    button{cursor:pointer;border:0;padding:12px 16px;border-radius:12px;font-weight:700;letter-spacing:.2px}
    .next{background:var(--brand);color:#fff;box-shadow:0 8px 20px -6px rgba(11,102,255,.5)}
    .back{background:#eef2f7;color:#2c3b5a}
    .submit{background:var(--ok);color:#fff;box-shadow:0 8px 20px -8px rgba(46,125,50,.5)}
    .tiny{font-size:12px;color:#7e8ba3;margin-top:12px}
    .center{text-align:center}
    /* Status */
    #status{margin-top:10px;min-height:16px;color:#64748b}
    #status.saved{color:#2e7d32}
    /* Responsive */
    @media (max-width:520px){
      .card{padding:22px}
      .label{display:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <h1>Weâ€™ll find the right local agent</h1>
      <p class="lead">Answer a few quick questions. Weâ€™ll compare recent results in your area and connect you with the best fit.</p>

      <!-- Stepper -->
      <ol class="stepper" id="stepper">
        <li class="active"><span class="dot">1</span><span class="label">Postcode</span></li>
        <li><span class="dot">2</span><span class="label">Type</span></li>
        <li><span class="dot">3</span><span class="label">Price</span></li>
        <li><span class="dot">4</span><span class="label">Address</span></li>
        <li><span class="dot">5</span><span class="label">Phone</span></li>
        <li><span class="dot">6</span><span class="label">Email</span></li>
      </ol>

      <div class="progress"><div class="bar" id="bar"></div></div>

      <form id="funnel" novalidate>
        <!-- 1. Postcode -->
        <div class="step active" data-step="1">
          <label for="postcode">Whatâ€™s your propertyâ€™s postcode?</label>
          <input id="postcode" name="postcode" inputmode="numeric" autocomplete="postal-code" minlength="4" maxlength="4" placeholder="e.g. 2170" required />
          <div class="hint">Used to check recent local sales and agent performance.</div>
          <div class="btns">
            <button type="button" class="next">Next</button>
          </div>
        </div>

        <!-- 2. Property Type -->
        <div class="step" data-step="2">
          <label for="ptype">Property type</label>
          <select id="ptype" name="propertyType" required>
            <option value="">Selectâ€¦</option>
            <option>House</option>
            <option>Land</option>
            <option>Unit</option>
            <option>Townhouse</option>
            <option>Other</option>
          </select>
          <div class="btns">
            <button type="button" class="back">Back</button>
            <button type="button" class="next">Next</button>
          </div>
        </div>

        <!-- 3. Price Point -->
        <div class="step" data-step="3">
          <label for="priceBand">Estimated price point</label>
          <select id="priceBand" name="priceBand" required>
            <option value="">Selectâ€¦</option>
            <option>0â€“500k</option>
            <option>500kâ€“1m</option>
            <option>$1mâ€“$2m</option>
            <option>$2m+</option>
          </select>
          <div class="btns">
            <button type="button" class="back">Back</button>
            <button type="button" class="next">Next</button>
          </div>
        </div>

        <!-- 4. Property Address -->
        <div class="step" data-step="4">
          <label for="address">Property address</label>
          <input id="address" name="address" placeholder="e.g. 10 Example St, Liverpool NSW" required />
          <div class="btns">
            <button type="button" class="back">Back</button>
            <button type="button" class="next">Next</button>
          </div>
        </div>

        <!-- 5. Phone -->
        <div class="step" data-step="5">
          <label for="phone">Best phone number</label>
          <input id="phone" name="phone" inputmode="tel" placeholder="e.g. 0400 000 000" required />
          <div class="hint">Weâ€™ll only use this to share your shortlist and next steps.</div>
          <div class="btns">
            <button type="button" class="back">Back</button>
            <button type="button" class="next">Next</button>
          </div>
        </div>

        <!-- 6. Email -->
        <div class="step" data-step="6">
          <label for="email">Email for your results</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />
          <div class="tiny">By continuing, you agree we may contact you about your appraisal. You can opt out anytime.</div>
          <div class="btns">
            <button type="button" class="back">Back</button>
            <button type="submit" class="submit">See my match</button>
          </div>
        </div>

        <!-- Thank you -->
        <div class="step" data-step="7">
          <div class="center" style="padding:8px 6px 2px">
            <h2 style="margin:4px 0 8px;color:var(--brand-ink)">Weâ€™ve found a match ðŸŽ‰</h2>
            <p style="margin:0 0 14px;color:#5d6b7b">Based on recent results in your area, <strong>Brock Morley</strong> is a great fit for your property.</p>
            <p class="tiny">Weâ€™ll reach out shortly with a quick appraisal and next steps.</p>
          </div>
        </div>
      </form>

      <div id="status" class="tiny" aria-live="polite"></div>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbwQW0E9h0gWIN-wX6CDKUQJrjXzkfgA6sTIpqwd3-HisuiiJGXgcgSsUl5HWH8uV48/exec";
    const PROJECT = "agent-matcher-v1";

    function normalizePostcode(v){ return String(v||"").replace(/\D/g,"").slice(0,4); }

    const leadId = (() => {
      const k = PROJECT + ":leadId";
      let id = localStorage.getItem(k);
      if (!id){ id = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2)); localStorage.setItem(k,id); }
      return id;
    })();

    const form = document.getElementById("funnel");
    const steps = [...form.querySelectorAll(".step")];
    const bar = document.getElementById("bar");
    const statusEl = document.getElementById("status");
    const stepper = document.getElementById("stepper").children;
    let stepIndex = 0;         // 0..6 (6 = thank you)
    const formSteps = 6;       // number of interactive steps

    const pcInput = document.getElementById("postcode");
    pcInput.addEventListener("input", () => {
      const normalized = normalizePostcode(pcInput.value);
      if (pcInput.value !== normalized) pcInput.value = normalized;
    });

    function updateUI(){
      // steps visibility
      steps.forEach((s, idx) => s.classList.toggle("active", idx === stepIndex));
      // progress bar
      const pct = Math.min(100, Math.round((Math.min(stepIndex+1, formSteps) / formSteps) * 100));
      bar.style.width = pct + "%";
      // stepper
      [...stepper].forEach((li, idx) => li.classList.toggle("active", idx === Math.min(stepIndex, formSteps-1)));
    }
    function showStep(i){ stepIndex = Math.max(0, Math.min(i, steps.length-1)); updateUI(); }

    function getCurrentFields(){
      const step = steps[stepIndex];
      const inputs = step.querySelectorAll("input, select");
      const data = {};
      inputs.forEach(inp => {
        let val = inp.value.trim();
        if (inp.id === "postcode") val = normalizePostcode(val);
        data[inp.name || inp.id] = val;
      });
      return data;
    }

    function validForStep(){
      const step = steps[stepIndex];
      const inputs = step.querySelectorAll("input[required], select[required]");
      for (const inp of inputs){
        let value = inp.value.trim();
        if (inp.id === "postcode") value = normalizePostcode(value);
        if (!value) return false;
        if (inp.type === "email" && !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(value)) return false;
        if (inp.id === "postcode" && value.length !== 4) return false;
      }
      return true;
    }

    async function savePartial(eventType){
      const payload = {
        leadId,
        event: eventType,
        stepNumber: stepIndex + 1,
        answers: getCurrentFields(),
        userAgent: navigator.userAgent,
        screen: { w: window.innerWidth, h: window.innerHeight, dpr: window.devicePixelRatio || 1 },
        ts: new Date().toISOString()
      };
      const json = JSON.stringify(payload);
      let sent = false;
      try{
        await fetch(WEBHOOK_URL, { method:"POST", mode:"no-cors", body:json, keepalive:true });
        sent = true;
      }catch(e){
        try{
          if (navigator.sendBeacon){
            const blob = new Blob([json], { type:"text/plain;charset=UTF-8" });
            navigator.sendBeacon(WEBHOOK_URL, blob);
            sent = true;
          }
        }catch(_){}
      }
      statusEl.textContent = sent ? "Saved." : "Working offlineâ€”will retry on next step.";
      statusEl.classList.toggle("saved", sent);
    }

    form.addEventListener("click", async (e)=>{
      const t = e.target;
      if (t.classList.contains("next")){
        if (!validForStep()){ statusEl.textContent = "Please complete this step."; statusEl.classList.remove("saved"); return; }
        await savePartial("step");
        showStep(stepIndex + 1);
      }
      if (t.classList.contains("back")){
        showStep(stepIndex - 1);
      }
    });

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      if (!validForStep()){ statusEl.textContent = "Please complete this step."; statusEl.classList.remove("saved"); return; }
      await savePartial("complete");
      showStep(formSteps);      // move to thank-you
    });

    showStep(0);
  </script>
</body>
</html>
